# ç°æœ‰æ•°æ®è¿ç§»æŒ‡å— - æ–¹æ¡ˆä¸‰å®æ–½

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å¸®åŠ©ä½ å°†ç°æœ‰æ•°æ®åº“ä¸­çš„å¸–å­æ•°æ®è¿ç§»åˆ°æ–°çš„ `tagDimensions` ç»“æ„ã€‚

## ğŸ¯ è¿ç§»ç­–ç•¥

**æ–¹æ¡ˆä¸‰ï¼ˆæ··åˆæ–¹æ¡ˆï¼‰**åŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼š

1. **é˜¶æ®µ1ï¼šè§„åˆ™æ˜ å°„** - å¿«é€Ÿå¤„ç†ï¼ˆ80-90%çš„æ•°æ®ï¼‰
   - ä» `title` æå–åœ°ç‚¹ã€æ‹›è˜ç±»å‹
   - ä» `tags` æå–æŠ€æœ¯æ ˆ
   - ä» `role` æ¨æ–­ category/subRole

2. **é˜¶æ®µ2ï¼šAIè¡¥å……** - ç²¾ç¡®å¤„ç†ï¼ˆ10-20%çš„æ•°æ®ï¼‰
   - å¯¹è§„åˆ™æ˜ å°„åä»æœ‰ç¼ºå¤±çš„æ•°æ®
   - ä½¿ç”¨AIæå–ç¼ºå¤±çš„ç»´åº¦

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
cd hh_pipeline

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
pip install pymongo

# é…ç½®MongoDBè¿æ¥ï¼ˆå¯é€‰ï¼‰
export MONGO_URI="mongodb://localhost:27017/offermagnet"
# æˆ–ä½¿ç”¨è¿œç¨‹MongoDB
# export MONGO_URI="mongodb+srv://user:pass@cluster.mongodb.net/offermagnet"

# å¦‚æœä½¿ç”¨AIè¡¥å……åŠŸèƒ½ï¼Œé…ç½®AI API Key
export QWEN_API_KEY="your-qwen-api-key"  # æ¨è
# æˆ–
export API_KEY="your-gemini-api-key"
```

### 2. è¿è¡Œè¿ç§»

#### æ¨èï¼šå®Œæ•´è¿ç§»ï¼ˆè§„åˆ™æ˜ å°„ + AIè¡¥å……ï¼‰

```bash
python migrate_existing_data.py --mode full
```

è¿™ä¼šï¼š
- å…ˆå¯¹æ‰€æœ‰æ•°æ®æ‰§è¡Œè§„åˆ™æ˜ å°„
- ç„¶åå¯¹ä»æœ‰ç¼ºå¤±çš„æ•°æ®è¿›è¡ŒAIè¡¥å……

#### å¿«é€Ÿè¿ç§»ï¼ˆä»…è§„åˆ™æ˜ å°„ï¼‰

å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå¯ä»¥å…ˆåªè¿è¡Œè§„åˆ™æ˜ å°„ï¼š

```bash
python migrate_existing_data.py --mode rules-only
```

ç¨åå†å¯¹ç¼ºå¤±çš„æ•°æ®è¿›è¡ŒAIè¡¥å……ï¼š

```bash
python migrate_existing_data.py --mode ai-only
```

### 3. æŸ¥çœ‹ç»“æœ

è¿ç§»å®Œæˆåï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºï¼š
- è¿ç§»è¿›åº¦ç»Ÿè®¡
- æ•°æ®è´¨é‡è¯„ä¼°ï¼ˆå„ç»´åº¦å¡«å……ç‡ï¼‰
- å®Œæ•´åº¦ç»Ÿè®¡

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

```
============================================================
ğŸ“¦ ç°æœ‰æ•°æ®è¿ç§»è„šæœ¬ - æ–¹æ¡ˆä¸‰ï¼ˆæ··åˆæ–¹æ¡ˆï¼‰
============================================================
æ¨¡å¼: full
æ‰¹é‡å¤§å°: 100

ğŸ”— è¿æ¥MongoDB: mongodb://localhost:27017/offermagnet
âœ… MongoDBè¿æ¥æˆåŠŸ

ğŸ“Š æ‰¾åˆ° 900 æ¡éœ€è¦è¿ç§»çš„æ•°æ®
  [10/900] âœ… å·²è¿ç§» (è§„åˆ™: 10, AI: 3)
  [20/900] âœ… å·²è¿ç§» (è§„åˆ™: 20, AI: 5)
  ...
  [900/900] âœ… å·²è¿ç§» (è§„åˆ™: 900, AI: 180)

ğŸ“Š è¿ç§»å®Œæˆ:
   âœ… è§„åˆ™æ˜ å°„: 900 æ¡
   ğŸ¤– AIè¡¥å……: 180 æ¡
   âŒ å¤±è´¥: 0 æ¡

âœ… æˆåŠŸè¿ç§»: 900/900 æ¡

ğŸ“ˆ æ•°æ®è´¨é‡è¯„ä¼°:
   categoryå¡«å……ç‡: 850/900 (94.4%)
   subRoleå¡«å……ç‡: 820/900 (91.1%)
   locationå¡«å……ç‡: 780/900 (86.7%)
   recruitTypeå¡«å……ç‡: 880/900 (97.8%)
   technologieså¡«å……ç‡: 700/900 (77.8%)
   å®Œæ•´åº¦ï¼ˆcategory+subRole+locationï¼‰: 750/900 (83.3%)
```

## ğŸ” è§„åˆ™æ˜ å°„é€»è¾‘è¯´æ˜

### åœ°ç‚¹æå–
- ä» `title` å’Œ `tags` ä¸­æœç´¢åŸå¸‚å…³é”®è¯
- æ”¯æŒï¼šåŒ—äº¬ã€ä¸Šæµ·ã€æ·±åœ³ã€æ­å·ã€å¹¿å·ã€æˆéƒ½ã€æ–°åŠ å¡ã€ç¡…è°·ã€çº½çº¦ã€ä¼¦æ•¦ã€é¦™æ¸¯

### æ‹›è˜ç±»å‹æå–
- ä» `title` å’Œ `tags` ä¸­æœç´¢å…³é”®è¯
- ä¼˜å…ˆçº§ï¼šæ ¡æ‹› > ç¤¾æ‹› > å®ä¹ 
- å¦‚æœæ— æ³•ç¡®å®šï¼Œé»˜è®¤ä¸º"å…¶ä»–"

### æŠ€æœ¯æ ˆæå–
- ä» `tags` æ•°ç»„ä¸­æå–å·²çŸ¥æŠ€æœ¯åç§°
- æ”¯æŒå¸¸è§æŠ€æœ¯ï¼šReact, Vue, Python, Java, Node.js, PyTorch, TensorFlow ç­‰

### éƒ¨é—¨ç±»åˆ«æ¨æ–­
- ä» `role` å­—æ®µæ¨æ–­
- æ”¯æŒï¼šç ”å‘ã€ç®—æ³•ã€äº§å“ã€è®¾è®¡ã€è¿è¥ã€å¸‚åœº

### å­è§’è‰²æ¨æ–­
- ä» `role` å’Œ `tags` ä¸­æ¨æ–­
- æ”¯æŒï¼šå‰ç«¯ã€åç«¯ã€ç§»åŠ¨ç«¯ã€å…¨æ ˆã€æµ‹è¯•ã€è¿ç»´ã€å¤§æ•°æ®ã€æ¶æ„ã€ç³»ç»Ÿè®¾è®¡ã€æœºå™¨å­¦ä¹ ã€CVã€NLPç­‰

## ğŸ¤– AIè¡¥å……é€»è¾‘

å½“è§„åˆ™æ˜ å°„åä»æœ‰ç¼ºå¤±ç»´åº¦æ—¶ï¼Œä¼šè°ƒç”¨AIè¿›è¡Œè¡¥å……ï¼š

- **ç¼ºå¤± category**ï¼šä» `processedContent` ä¸­æå–éƒ¨é—¨ç±»åˆ«
- **ç¼ºå¤± subRole**ï¼šä» `processedContent` ä¸­æå–å­è§’è‰²
- **ç¼ºå¤± location**ï¼šä» `processedContent` ä¸­æå–åœ°ç‚¹
- **recruitType ä¸º"å…¶ä»–"**ï¼šä» `processedContent` ä¸­æå–å‡†ç¡®çš„æ‹›è˜ç±»å‹

**æ³¨æ„**ï¼šAIè¡¥å……éœ€è¦ `processedContent` å­—æ®µå­˜åœ¨ä¸”é•¿åº¦ > 50 å­—ç¬¦ã€‚

## âš™ï¸ é«˜çº§é€‰é¡¹

### è‡ªå®šä¹‰MongoDB URI

```bash
python migrate_existing_data.py --mode full --mongo-uri "mongodb+srv://user:pass@cluster.mongodb.net/offermagnet"
```

### è°ƒæ•´æ‰¹é‡å¤§å°

```bash
python migrate_existing_data.py --mode full --batch-size 50
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½**ï¼šå»ºè®®åœ¨è¿è¡Œè¿ç§»å‰å¤‡ä»½æ•°æ®åº“
   ```bash
   mongodump --uri="mongodb://localhost:27017/offermagnet" --out=./backup
   ```

2. **AIæˆæœ¬**ï¼šAIè¡¥å……ä¼šè°ƒç”¨APIï¼Œæ³¨æ„æˆæœ¬æ§åˆ¶
   - è§„åˆ™æ˜ å°„ï¼šæ— æˆæœ¬
   - AIè¡¥å……ï¼šæ¯æ¡æ•°æ®çº¦ 0.001-0.01 å…ƒï¼ˆå–å†³äºAPIï¼‰

3. **å¹‚ç­‰æ€§**ï¼šè„šæœ¬ä¼šè·³è¿‡å·²æœ‰ `tagDimensions` çš„æ•°æ®ï¼Œå¯ä»¥å®‰å…¨åœ°é‡å¤è¿è¡Œ

4. **æ€§èƒ½**ï¼š
   - è§„åˆ™æ˜ å°„ï¼šçº¦ 100-200 æ¡/ç§’
   - AIè¡¥å……ï¼šçº¦ 10-30 æ¡/ç§’ï¼ˆå–å†³äºAPIå“åº”é€Ÿåº¦ï¼‰

## ğŸ”„ è¿ç§»åéªŒè¯

è¿ç§»å®Œæˆåï¼Œå¯ä»¥æ‰‹åŠ¨éªŒè¯æ•°æ®è´¨é‡ï¼š

```python
from pymongo import MongoClient

client = MongoClient("mongodb://localhost:27017/offermagnet")
db = client["offermagnet"]
posts = db["posts"]

# æ£€æŸ¥è¿ç§»å®Œæˆæƒ…å†µ
total = posts.count_documents({})
migrated = posts.count_documents({"tagDimensions": {"$exists": True, "$ne": None, "$ne": {}}})
print(f"è¿ç§»å®Œæˆç‡: {migrated}/{total} ({migrated/total*100:.1f}%)")

# æŸ¥çœ‹ç¤ºä¾‹æ•°æ®
sample = posts.find_one({"tagDimensions": {"$exists": True}})
if sample:
    print("\nç¤ºä¾‹æ•°æ®:")
    print(f"æ ‡é¢˜: {sample.get('title')}")
    print(f"tagDimensions: {sample.get('tagDimensions')}")
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šMongoDBè¿æ¥å¤±è´¥

```
âŒ MongoDBè¿æ¥å¤±è´¥: ...
```

**è§£å†³**ï¼š
- æ£€æŸ¥MongoDBæ˜¯å¦è¿è¡Œï¼š`mongosh --eval "db.adminCommand('ping')"`
- æ£€æŸ¥è¿æ¥URIæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

### é—®é¢˜2ï¼šAI APIæœªé…ç½®

```
âš ï¸  AI APIæœªé…ç½®ï¼Œè·³è¿‡AIè¡¥å……
```

**è§£å†³**ï¼š
- å¦‚æœåªéœ€è¦è§„åˆ™æ˜ å°„ï¼Œå¯ä»¥å¿½ç•¥æ­¤è­¦å‘Š
- å¦‚æœéœ€è¦AIè¡¥å……ï¼Œé…ç½® `QWEN_API_KEY` æˆ– `API_KEY`

### é—®é¢˜3ï¼šAIå¤„ç†å¤±è´¥

```
âš ï¸  AIå¤„ç†å¤±è´¥: ...
```

**è§£å†³**ï¼š
- æ£€æŸ¥API Keyæ˜¯å¦æœ‰æ•ˆ
- æ£€æŸ¥APIé…é¢æ˜¯å¦ç”¨å®Œ
- å¯ä»¥ç¨åä½¿ç”¨ `--mode ai-only` é‡è¯•å¤±è´¥çš„æ•°æ®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®æ ¼å¼è§„èŒƒ](./DATA_FORMAT_SPEC.md) - tagDimensions ç»“æ„è¯´æ˜
- [Pipeline README](./README.md) - æ–°æ•°æ®å¤„ç†æµç¨‹

