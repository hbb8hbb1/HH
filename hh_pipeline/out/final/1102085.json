{
  "title": "SQL实现AB测试结果分析：四类T检验方法详解",
  "originalContent": "<div class=\"article_body\"><td class=\"t_f\" id=\"postmessage_20022107\" itemprop=\"articleBody\">\n<br/>\n分为四种情况：one sample/two sample, non proportional/proportional<br/>\n需要深入地理解ttest，同时也要能够在实际的Code中计算出<font size=\"4\"><strong>1. One-Sample T-Test (Non-Proportion)</strong></font><div class=\"blockcode\"><div id=\"code_sv5\"><ol><li>-- Step 1: Define hypothesized mean</li><li>WITH hypothesized_mean AS (</li><li>    SELECT 100.0 AS mu0 -- Replace 100.0 with your hypothesized mean</li><li>),</li><li>-- Step 2: Calculate sample statistics</li><li>sample_stats AS (</li><li>    SELECT</li><li>        COUNT(value) AS n,</li><li>        AVG(value) AS sample_mean,</li><li>        STDDEV(value) AS sample_stddev -- Use STDDEV_SAMP in some SQL dialects 注意计算sample的standard deviation 有 n与n-1的区别</li><li>    FROM observations</li><li>),</li><li></li><li>-- Step 3: Calculate the t-statistic</li><li>t_statistic AS (</li><li>    SELECT</li><li>        (sample_mean - mu0) / (sample_stddev / SQRT(n)) AS t_value, --最重要的公式</li><li>        n - 1 AS degrees_of_freedom</li><li>    FROM sample_stats, hypothesized_mean</li><li>),</li><li></li><li>-- Step 4: Return results</li><li>results AS (</li><li>    SELECT</li><li>        t_value,</li><li>        degrees_of_freedom,</li><li>        CASE</li><li>            WHEN ABS(t_value) &gt;1.96 THEN 'Reject Null Hypothesis' -- Critical value 一般情况下使用z score 为了方便起见</li><li>            ELSE 'Fail to Reject Null Hypothesis'</li><li>        END AS conclusion</li><li>    FROM t_statistic</li><li>)</li><li></li><li>-- Output</li><li>SELECT * FROM results;</li><li></li></ol></div><em onclick=\"copycode($('code_sv5'));\">复制代码</em></div><font size=\"4\"></font><br/>\n<font size=\"4\"><strong>2. Two-Sample T-Test (Non-Proportion)</strong></font><br/>\n<div id=\"1p3a-ad-thread-paragraph\" style=\"margin-top: 20px; margin-bottom: 20px;\"></div><br/>\nTest if the means of two independent samples are different.SQL Code:<div class=\"blockcode\"><div id=\"code_q14\"><ol><li>Step 1: Calculate sample statistics for each group</li><li>WITH group_stats AS (</li><li>    SELECT</li><li>        group,</li><li>        COUNT(value) AS n,</li><li>        AVG(value) AS mean,</li><li>        VARIANCE(value) AS variance -- Use STDDEV(value)^2 for variance in some SQL dialects</li><li>    FROM observations</li><li>    GROUP BY group</li><li>),</li><li></li><li>-- Step 2: Calculate pooled variance</li><li>pooled_variance AS (</li><li>    SELECT</li><li>        SUM((n - 1) * variance) / (SUM(n) - 2) AS pooled_var </li><li>    FROM group_stats</li><li>),</li><li></li><li>-- Step 3: Calculate the t-statistic</li><li>t_statistic AS (</li><li>    SELECT</li><li>        (g1.mean - g2.mean) /</li><li>        SQRT(pooled_var * (1.0 / g1.n + 1.0 / g2.n)) AS t_value,</li><li>        (g1.n + g2.n - 2) AS degrees_of_freedom</li><li>    FROM group_stats g1</li><li>    CROSS JOIN group_stats g2</li><li>    CROSS JOIN pooled_variance</li><li>    WHERE g1.group = 'A' AND g2.group = 'B' -- Replace 'A' and 'B' with actual group identifiers</li><li>),</li><li></li><li>-- Step 4: Return results</li><li>results AS (</li><li>    SELECT</li><li>        t_value,</li><li>        degrees_of_freedom,</li><li>        CASE</li><li>            WHEN ABS(t_value) &gt; 1.96</li><li>            ELSE 'Fail to Reject Null Hypothesis'</li><li>        END AS conclusion</li><li>    FROM t_statistic</li><li>)</li><li></li><li>-- Output</li><li>SELECT * FROM results;</li></ol></div><em onclick=\"copycode($('code_q14'));\">复制代码</em></div><br/>\n<font size=\"4\"><strong>3. One-Sample Proportion Test</strong></font><br/>\n<br/>\nTest if the sample proportion differs from a hypothesized proportionSQL Code:<div class=\"blockcode\"><div id=\"code_eDz\"><ol><li>-- Step 1: Define hypothesized proportion</li><li>WITH hypothesized_proportion AS (</li><li>    SELECT 0.5 AS p0 -- Replace 0.5 with your hypothesized proportion</li><li>),</li><li></li><li>-- Step 2: Calculate sample statistics</li><li>sample_stats AS (</li><li>    SELECT</li><li>        COUNT(*) AS n,</li><li>        SUM(outcome) * 1.0 / COUNT(*) AS sample_proportion -- Proportion (p)</li><li>    FROM observations</li><li>),</li><li></li><li>-- Step 3: Calculate the t-statistic</li><li>t_statistic AS (</li><li>    SELECT</li><li>        (sample_proportion - p0) /</li><li>        SQRT(p0 * (1 - p0) / n) AS t_value</li><li>    FROM sample_stats, hypothesized_proportion</li><li>),</li><li></li><li>-- Step 4: Return results</li><li>results AS (</li><li>    SELECT</li><li>        t_value,</li><li>        CASE</li><li>            WHEN ABS(t_value) &gt; 1.96 THEN 'Reject Null Hypothesis' </li><li>            ELSE 'Fail to Reject Null Hypothesis'</li><li>        END AS conclusion</li><li>    FROM t_statistic</li><li>)</li><li>-- Output</li><li>SELECT * FROM results;</li></ol></div><em onclick=\"copycode($('code_eDz'));\">复制代码</em></div><font size=\"4\"><strong>4. Two-Sample T-Test (Proportion)</strong></font><br/>\n<br/>\nTest if the means of two independent samples are different.SQL Code:<strong>Adjusted SQL Code for Two-Sample Proportion Test</strong><div class=\"blockcode\"><div id=\"code_d4k\"><ol><li>-- Step 1: Calculate sample statistics for each group</li><li>WITH group_stats AS (</li><li>    SELECT</li><li>        group,</li><li>        COUNT(*) AS n,</li><li>        SUM(outcome) * 1.0 / COUNT(*) AS proportion -- Proportion (p)</li><li>    FROM observations</li><li>    GROUP BY group</li><li>),</li><li></li><li>-- Step 2: Calculate the standard error squared (SE^2)</li><li>standard_error_squared AS (</li><li>    SELECT</li><li>        g1.group AS group1,</li><li>        g2.group AS group2,</li><li>        g1.proportion AS p1,</li><li>        g2.proportion AS p2,</li><li>        g1.n AS n1,</li><li>        g2.n AS n2,</li><li>        -- Calculate SE^2 for each group</li><li>        (g1.proportion * (1 - g1.proportion) / g1.n) + </li><li>        (g2.proportion * (1 - g2.proportion) / g2.n) AS se_squared</li><li>    FROM group_stats g1</li><li>    CROSS JOIN group_stats g2</li><li>    WHERE g1.group = 'A' AND g2.group = 'B' -- Replace 'A' and 'B' with group identifiers</li><li>),</li><li></li><li>-- Step 3: Calculate the t-statistic</li><li>z_statistic AS (</li><li>    SELECT</li><li>        (p1 - p2) / SQRT(se_squared) AS t_value</li><li>    FROM standard_error_squared</li><li>),</li><li></li><li>-- Step 4: Return results</li><li>results AS (</li><li>    SELECT</li><li>        t_value,</li><li>        CASE</li><li>            WHEN ABS(t_value) &gt; 1.96 THEN 'Reject Null Hypothesis' </li><li>            ELSE 'Fail to Reject Null Hypothesis'</li><li>        END AS conclusion</li><li>    FROM t_statistic</li><li>)</li><li></li><li>-- Output</li><li>SELECT * FROM results;</li><li></li></ol></div><em onclick=\"copycode($('code_d4k'));\">复制代码</em></div><font size=\"4\"></font><br/>\n<br/>\n<br/>\n<br/>\n求点大米～感谢</td></div>",
  "processedContent": "## 基本信息\n- **公司**：未提及/不明确\n- **岗位**：数据分析师 / 数据科学家（推测）\n- **结果**：未提及/不明确\n- **难度**：4\n\n## 时间线\n未提及/不明确\n\n## 面试过程\n### 笔试 / OA\n面试中包含一道关于使用 SQL 实现 AB 测试统计分析的编程题。题目要求候选人掌握基本的假设检验原理，并能用 SQL 编码实现不同类型的 T 检验。\n\n考察内容包括：\n- One-Sample T-Test（均值非比例型）\n- Two-Sample T-Test（独立样本均值比较）\n- One-Sample Proportion Test（单样本比例检验）\n- Two-Sample Proportion Test（两样本比例检验）\n\n每种情况均需通过多步 CTE 构建统计量，计算 t/z 值并做出显著性判断。\n\n## 题目总结\n- 使用 SQL 实现以下四类假设检验：\n  1. **单样本 T 检验（连续变量）**\n     - 计算样本均值、标准差\n     - 构造 t 统计量：`(sample_mean - mu0) / (stddev / SQRT(n))`\n     - 自由度为 `n - 1`，与临界值比较（如1.96）判断是否拒绝原假设\n  \n  2. **双样本 T 检验（连续变量，独立组间均值差异）**\n     - 分组统计 n, mean, variance\n     - 计算合并方差（pooled variance）\n     - t 值公式：`(mean1 - mean2) / sqrt(pooled_var * (1/n1 + 1/n2))`\n     - 自由度：`n1 + n2 - 2`\n\n  3. **单样本比例检验**\n     - 定义假设比例 p0\n     - 样本比例 = sum(outcome)/count(*)\n     - z 值：`(p_hat - p0) / sqrt(p0*(1-p0)/n)`\n     - 判断 |z| > 1.96 是否成立\n\n  4. **双样本比例检验**\n     - 各组分别计算比例和样本量\n     - 标准误平方：`p1(1-p1)/n1 + p2(1-p2)/n2`\n     - z 值：`(p1 - p2) / sqrt(se_squared)`\n     - 使用正态近似判断显著性\n\n> 注：所有实现均基于 SQL 的 WITH CTE 结构，强调可读性和模块化设计。\n\n## 个人总结\n- 面试重点在于将统计学知识转化为 SQL 代码的能力，不仅需要理解公式，还需注意 SQL 中函数差异（如 STDDEV vs STDDEV_SAMP）。\n- 建议熟练掌握：\n  - CTE 多层嵌套写法\n  - 假设检验的基本逻辑（H0/H1, p-value, critical value）\n  - 比例检验与均值检验的区别及适用场景\n- 实际工作中 AB 测试分析常见此类需求，建议提前准备模板代码以便快速作答。",
  "company": "未提及/不明确",
  "role": "数据分析师",
  "difficulty": 4,
  "tags": [
    "SQL",
    "AB测试",
    "假设检验",
    "数据分析",
    "统计学",
    "编程题",
    "笔试"
  ],
  "comments": [],
  "usefulVotes": 0,
  "uselessVotes": 0,
  "shareCount": 0,
  "isAnonymous": true
}